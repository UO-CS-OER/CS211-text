
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How Python Works &#8212; Introduction to Computer Science II</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Appendices/appendix_internals';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Style Guide for Python Programs" href="appendix_style.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-provisional.png" class="logo__image only-light" alt="Introduction to Computer Science II - Home"/>
    <img src="../_static/logo-provisional.png" class="logo__image only-dark pst-js-only" alt="Introduction to Computer Science II - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction to Computer Science, part 2
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">00 Preliminaries</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00-Preliminaries/00-01-Prospectus.html">A Course in Computational Thinking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00-Preliminaries/00-02-Install.html">Installing Python and IDLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00-Preliminaries/00-03-Install_IDE.html">Installing an Interactive Development Environment (IDE)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">01 Objects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01-Objects/01_1_Objects.html">Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Objects/01_2_Magic.html">Magic Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Objects/01_3_References.html">References to Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Objects/01_4_Project.html">Project:  Overlapping Appointments</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">02 Inheritance</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_Inheritance/02_1_Inheritance.html">Class Hierarchies and Inheritance</a></li>

<li class="toctree-l1"><a class="reference internal" href="../02_Inheritance/02_2_Notifiers.html">Notifiers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">03 Recursion</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_Recursion/03_1_Recursion.html">Recursion in Object-Oriented Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_Recursion/03_2_Refactor.html">Refactoring Repetitive Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">04 Aliasing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_Alias/04_1_Alias.html">Aliasing on Purpose</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">05 Guess and Check</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../05_GuessCheck/05_1_GuessCheck.html">Recursive Guess and Check</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">06 Binary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../06_Binary/06_1_Bits.html">Bit Twiddling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Binary/06_2_NegBits.html">Negative Binary Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_Binary/06_3_Hex.html">What the Hex?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">07 Functional</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../07_Functional/07_1_Functional.html">Sometimes Functions are Values</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">08 Assembler</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../08_Assembler/08_1_Twopass.html">Two Pass Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_Assembler/08_2_Regexp.html">Regular expressions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix_terms.html">Glossary of Terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_looploop.html">Appendix – What for?</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_Special.html">Appendix – Magic Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_style.html">Style Guide for Python Programs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How Python Works</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/UO-CS-OER/CS210-text/main?urlpath=tree/Intro_to_CS/Appendices/appendix_internals.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/UO-CS-OER/CS210-text" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/UO-CS-OER/CS210-text/issues/new?title=Issue%20on%20page%20%2FAppendices/appendix_internals.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Appendices/appendix_internals.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../_sources/Appendices/appendix_internals.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How Python Works</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#or-seven-things-they-never-told-you-about-python">Or: Seven things they never told you about Python.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-source-luke">Use the source, Luke</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#translation-and-execution">Translation and Execution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-translation-compared-to-java-c-etc">Python translation compared to Java, C, etc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-data-types-in-cpython">Key Data Types in CPython</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#class-list">Class <code class="docutils literal notranslate"><span class="pre">list</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#class-int">Class <code class="docutils literal notranslate"><span class="pre">int</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#class-dict">Class <code class="docutils literal notranslate"><span class="pre">dict</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-python-works">
<h1>How Python Works<a class="headerlink" href="#how-python-works" title="Link to this heading">#</a></h1>
<section id="or-seven-things-they-never-told-you-about-python">
<h2>Or: Seven things they never told you about Python.<a class="headerlink" href="#or-seven-things-they-never-told-you-about-python" title="Link to this heading">#</a></h2>
<p>Number 5 will blow your mind.</p>
<p>You write programs in Python to run with the Python interpreter,
but the Python interpreter itself is a computer program.
Let’s look inside.</p>
</section>
<section id="use-the-source-luke">
<h2>Use the source, Luke<a class="headerlink" href="#use-the-source-luke" title="Link to this heading">#</a></h2>
<p>Although there are alternative implementations of Python, when
someone mentioned “the Python interpreter”, they usually mean
CPython.  That’s the version of Python that you can download and
install from <code class="docutils literal notranslate"><span class="pre">python.org</span></code>.  CPython 2.x and CPython 3.x are both
versions of CPython.</p>
<p>CPython is an open source project.  It is hosted on GitHub,
like our projects, but it is somewhat larger.  You can
find it at <a class="reference external" href="https://github.com/python/cpython"><code class="docutils literal notranslate"><span class="pre">https://github.com/python/cpython</span></code></a>.
Perhaps one day you will contribute a new feature to CPython, or fix a bug.</p>
<p>As a relatively new developer, it is likely a little daunting to
dive into a codebase of this size and complexity, but there is
documentation to help you when you are ready.
An overall guide for developers who want to contribute
to the Python project can be found at
<a class="reference external" href="https://devguide.python.org/"><code class="docutils literal notranslate"><span class="pre">https://devguide.python.org/</span></code></a>.
A more general guide for understanding Python’s internals, even if you do not
want to contribute to Python’s development, can be found
at <a class="reference external" href="https://devguide.python.org/exploring/"><code class="docutils literal notranslate"><span class="pre">https://devguide.python.org/exploring/</span></code></a>.</p>
<p>Philip Guo, creator of the wonderful
<a class="reference external" href="http://pythontutor.com/">PythonTutor</a>,
has recorded lectures of a class he taught on on internals
of CPython 2.7.  I have watched only parts.  They are very good, as
I would expect, but move a little slowly because they are
recordings of actual class interactions. You can find them at
<a class="reference external" href="http://pgbovine.net/cpython-internals.htm"><code class="docutils literal notranslate"><span class="pre">http://pgbovine.net/cpython-internals.htm</span></code></a>.</p>
<p>I expect these guides and the source code itself will be more accessible to
you when you are a little farther along in computer science.  In the remainder
of this document, I’ll try to describe some key aspects of how
CPython 3 works,
but in less detail and with fewer assumptions about your background.</p>
</section>
<section id="translation-and-execution">
<h2>Translation and Execution<a class="headerlink" href="#translation-and-execution" title="Link to this heading">#</a></h2>
<p>CPython is an interpreter. That means it reads Python source code and then
executes instructions that “interpret” the program.  In CIS 211 you<br />
write an interpreter for a calculator, and in the final project you
write a compiler for a simple language to run on the Duck Machine.<br />
CPython is more complex, but not essentially different.</p>
<p>The CPython interpreter works in two phases.  In the first phase, CPython
translates Python source code into an intermediate, lower-level representation.
The lower level representation is designed to be efficient for execution,
and is not readily readable by humans. It is a sequence of instructions for
a Python <em>virtual machine</em>, which is a program simulating a special purpose
Python computer.</p>
<p>The Python virtual machine, or byte code interpreter, is a simulated
computer like our Duck Machine.  Unlike our Duck Machine, though, it
is not designed to be simulate a real hardware computer.  It is instead
an imaginary machine specialized for executing Python programs.  It doesn’t
have registers like the Duck Machine, but it has several data structures
for managing Python program execution.  One of the key data structures
is a <em>stack</em>.  Virtual machines like the one in CPython are called
<em>stack machines</em> because their <em>stack</em> is used much the way
registers are used in a physical computer.</p>
<p>Each of the operations of the Python
virtual machine is more complex than
individual operations on the Duck Machine.
Since the Python virtual machine is a stack
machine, the byte code instructures are arranged
in postfix order, much like the input of our calculator.
For example, this small Python function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simple</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
<p>is translated into the following byte code instructions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOAD_CONST</span>  <span class="mi">1</span>   <span class="c1"># Push constant 11, which is at location 1</span>
<span class="n">STORE_FAST</span>  <span class="mi">2</span>   <span class="c1"># Pop and store in x, at location 2</span>
<span class="n">LOAD_FAST</span>   <span class="mi">0</span>   <span class="c1"># Push first argument a, found at address 0</span>
<span class="n">LOAD_FAST</span>   <span class="mi">1</span>   <span class="c1"># Push second argument b, found at address 1</span>
<span class="n">LOAD_FAST</span>   <span class="mi">2</span>   <span class="c1"># Push value of x </span>
<span class="n">BINARY_MULTIPLY</span> <span class="c1"># Pops values of x and b, pushes x*b</span>
<span class="n">BINARY_ADD</span>      <span class="c1"># Pops values x*b and a,  pushes a + x*b</span>
<span class="n">STORE_FAST</span>  <span class="mi">3</span>   <span class="c1"># Pop sum and store in variable c</span>
<span class="n">LOAD_FAST</span>   <span class="mi">3</span>   <span class="c1"># Push value of c, found at address 3</span>
<span class="n">RETURN_VALUE</span>    <span class="c1"># Pop value and return it</span>
</pre></div>
</div>
<p>This is not very clever code!  Note how it pops a value to store
in variable <code class="docutils literal notranslate"><span class="pre">c</span></code>, then immediately pushes that value back on the
stack before returning it.  When you write a code generator,
do not despair over the quality of code you produce.  Code generators
written by experts are pretty bad too.  (Language translators often
have an optional <em>optimization</em> phase that improves the generated
code somewhat.)</p>
<p>What does the <code class="docutils literal notranslate"><span class="pre">BINARY_ADD</span></code> byte code instruction do?  You already
know:  It calls the <code class="docutils literal notranslate"><span class="pre">__add__</span></code> method on its operand.  This is a
very complex operation compared to the simple operations performed
by each instruction in a physical CPU.</p>
</section>
<section id="python-translation-compared-to-java-c-etc">
<h2>Python translation compared to Java, C, etc<a class="headerlink" href="#python-translation-compared-to-java-c-etc" title="Link to this heading">#</a></h2>
<p>Many language implementations use a two-step process
much like Python.  If you have programmed in Java,
the first part (translation to byte code) was what the
<code class="docutils literal notranslate"><span class="pre">javac</span></code> program did, and the second part (executing
the byte code) was what the <code class="docutils literal notranslate"><span class="pre">java</span></code> program did.  The
Java virtual machine differs from the Python virtual
machine in several regards, but it too is a stack machine.</p>
<p>Some language implementations take a different approach,
translating the source language (like C or C++) to
the actual machine code of a physical machine. This is
called “compiling” or “compiling to native code”.
The CPython interpreter itself is a C program that has
been compiled to native code, which might be the machine
code for an Intel x86 processor or the machine code for
an ARM CPU (for example, if you run Python on a
Raspberry Pi).</p>
<p>In principle the same language can be translated in different
manners.  There is nothing to prevent building an interpreter
for C (and it has been done), and it is possible in principle
to build a native code compiler for Python (but it’s not easy).
In practice, some language designs lend themselves to native
code compilation, and some make it more difficult.  Python was
designed to be an interpreted language.</p>
<p>Further reading:  There is a very nice, basic description of
the Python virtual stack machine at
<a class="reference external" href="https://www.ics.uci.edu/~brgallar/week9_3.html">https://www.ics.uci.edu/~brgallar/week9_3.html</a>.</p>
</section>
<section id="key-data-types-in-cpython">
<h2>Key Data Types in CPython<a class="headerlink" href="#key-data-types-in-cpython" title="Link to this heading">#</a></h2>
<p>The built-in object types in Python include integers,
strings, lists, and dicts.  There is a built-in class
for each of these.  The built-in classes are almost like
classes you define in Python, but they are actually written
in C.</p>
<p>All Python objects, from integers to classes to strings, are
represented by <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> structures (<code class="docutils literal notranslate"><span class="pre">struct</span></code>) in the CPython
code.   All <code class="docutils literal notranslate"><span class="pre">PyObject</span></code> structures have a header part, which contains
a reference to its type (which in Python is a <code class="docutils literal notranslate"><span class="pre">class</span></code> object)
and a <em>reference count</em>, used by the garbage collector.
Information specific to each built-in type in Python follows the
<code class="docutils literal notranslate"><span class="pre">PyObject</span></code> header.</p>
</section>
<section id="class-list">
<h2>Class <code class="docutils literal notranslate"><span class="pre">list</span></code><a class="headerlink" href="#class-list" title="Link to this heading">#</a></h2>
<p>A Python <code class="docutils literal notranslate"><span class="pre">list</span></code> is represented by a structure sometimes called a
<em>flexible array</em>.  After the headers, elements of the list (which are
always references to other objects) are stored in an array.  We call
it a <em>flexible</em> array because the list has a capacity that may be
greater than the number of elements currently in the list.  For
example, if we had a list with two elements</p>
<p><img alt="List object" src="../_images/list-concept-2elem.png" /></p>
<p>the <code class="docutils literal notranslate"><span class="pre">append</span></code> method would use the next available space in the array
and update information in the list headers part of the structure.</p>
<p><img alt="Appending one more" src="../_images/list-concept-3elem.png" /></p>
<p>This makes the <code class="docutils literal notranslate"><span class="pre">append</span></code> and <code class="docutils literal notranslate"><span class="pre">pop</span></code> methods very efficient if you always
append and pop at the end of the list.  If the capacity of the list
is exhausted, appending a new element requires allocating a larger
flexible array.</p>
<p><img alt="Grow the array" src="../_images/list-concept-4elem.png" /></p>
<p>The details are a little more complicated.  First, a <code class="docutils literal notranslate"><span class="pre">list</span></code> object,
like all Python objects, starts with a header that identifies the
type of the object and holds some bookkeeping information for the
garbage collector (the component that recycles unused objects).
Second, Python can’t just put the flexible part of the object adjacent
to the header in memory, because there might not be available space to
expand it when its capacity is exhausted.  So, instead, the header
contains a pointer to the variable part.  When we expand the capacity
of the flexible array, we discard the old area (allowing the garbage
collector to recycle it) and allocate a new one.</p>
<p><img alt="Expanding the flexible array representation" src="../_images/list-object-append.svg" /></p>
<p>Python never moves object headers.  This is so that an object reference
in Python can be represented simply as a memory address.  If object
headers
moved around, references would either need a more complex
representation, or
else all references to an object would need to be modified when the
object header moved.  In consequence, all the mutable container
classes of Python (lists, dicts, sets, strings) have a fixed header
with a pointer to the part that can grow.</p>
<section id="class-int">
<h3>Class <code class="docutils literal notranslate"><span class="pre">int</span></code><a class="headerlink" href="#class-int" title="Link to this heading">#</a></h3>
<p>Although memory hardware is not really “typed”, CPUs have
operations like ADD that treat values as integers.
Most programming languages have an integer type that
is essentially just a 32-bit or 64-bit integer exactly
as supported by the hardware.  Python’s <code class="docutils literal notranslate"><span class="pre">int</span></code> class is
different.  A Python <code class="docutils literal notranslate"><span class="pre">int</span></code> is actually an object wrapper for
a variable length list of integers.  Python uses this
representation so that it can deal with very large numbers,
even larger than 64 bits which is typically the upper
limit for integers in languages like Java and C.
When you add two large integers, Python may actually execute
a loop to add up corresponding parts!</p>
<p>Because the <code class="docutils literal notranslate"><span class="pre">int</span></code> class really is a class, it has methods
like any other class.  When we add <code class="docutils literal notranslate"><span class="pre">int</span></code> objects, we call the
<code class="docutils literal notranslate"><span class="pre">__add__</span></code> method just like we would if we were adding strings
(whose <code class="docutils literal notranslate"><span class="pre">__add__</span></code> method concatenates strings).  The <code class="docutils literal notranslate"><span class="pre">__add__</span></code>
method for <code class="docutils literal notranslate"><span class="pre">int</span></code>, and all the other arithmetic methods for <code class="docutils literal notranslate"><span class="pre">int</span></code>,
are implemented in C.</p>
<p>While some <code class="docutils literal notranslate"><span class="pre">int</span></code> objects may have more digits than others, and
therefore occupy more a larger area of memory, <code class="docutils literal notranslate"><span class="pre">int</span></code> objects never
have to grow because they are <em>immutable</em>.  When you add 329 and 41,
you do not change 329 or change 41, but rather create a new <code class="docutils literal notranslate"><span class="pre">int</span></code>
object to hold the value 370. Because they are immutable, an <code class="docutils literal notranslate"><span class="pre">int</span></code>
object need not be split into a fixed part and a variable part
like a <code class="docutils literal notranslate"><span class="pre">list</span></code> object.</p>
<p>While the standard integer representation in all modern
computers I am aware of uses 2s complement representation
for negative numbers, Python uses sign and magnitude
representation.  The magnitude is represented by a sequence
of 30-bit “digits”. The number of digits is stored in the
header of the <code class="docutils literal notranslate"><span class="pre">int</span></code> object.  Since the number of digits can
never be negative, a digit count of <span class="math notranslate nohighlight">\(-k\)</span> is used to indicate
that there are <span class="math notranslate nohighlight">\(k\)</span> digits and the value is negative.  For
example, a very large negative integer might have a size field
of <span class="math notranslate nohighlight">\(-3\)</span>, indicating that it requires three 30-bit digits (each
of which is represented as a non-negative integer) and that the value
is negative.</p>
<p><img alt="A negative integer with 3 30-bit digits" src="../_images/int-neg-3digits.svg" /></p>
<p>The sign and magnitude representation and variable length
complicate every arithmetic operation,
but the interpreter uses some clever tricks to make arithmetic
on small numbers reasonably efficient.  There are special cases in the
interpreter code for integers small enough to fit entirely in a 32-bit
machine word.  Python also keeps a stash of common small values that
it reuses so that it doesn’t have to create as many new <code class="docutils literal notranslate"><span class="pre">int</span></code> objects.
Nevertheless arithmetic in Python is much, much slower than arithmetic
in a language like C or Java.</p>
<p>You might be aware that a lot of scientific computing is done in
Python,
and you might wonder how that can be feasible given the very
inefficient (but flexible!) representation of <code class="docutils literal notranslate"><span class="pre">int</span></code>.  The answer is
that high performance scientific programs do not depend too
heavily on the built-in Python <code class="docutils literal notranslate"><span class="pre">int</span></code> type (nor even on <code class="docutils literal notranslate"><span class="pre">float</span></code>).
Scientific computing relies heavily on the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy</span>&#160; </code> libraries,
which provide their own implementation of arrays and matrices of
numbers.  The numbers in those arrays and matrices are not Python
<code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code> numbers, but rather a more basic, less flexible
representation, exactly as you would find in C or C++ code (and in
fact implemented in C).</p>
</section>
<section id="class-dict">
<h3>Class <code class="docutils literal notranslate"><span class="pre">dict</span></code><a class="headerlink" href="#class-dict" title="Link to this heading">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">dict</span></code> is implemented as a <em>hash table</em>.  Like a list, it is a
container class that might need to be expanded as items are added,
so it is broken into a head part with a fixed address and a
content part of “payload” that can be reallocated with a larger
capacity.</p>
<p>Hash tables (called “hashmaps” in Java) are a form of “scatter
storage”.   Let’s consider the dict <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;dog&quot;:</span> <span class="pre">22,</span> <span class="pre">&quot;cat&quot;:</span> <span class="pre">13</span> <span class="pre">}</span></code>,
and assume the <code class="docutils literal notranslate"><span class="pre">dict</span></code> structure initially has room for 5 (key, value)
pairs.</p>
<p><img alt="" src="../_images/dict-2elem.svg" /></p>
<p>The <em>items</em> part of the structure
holds the (key, value) pairs (which are
actually references to other objects).
Each new entry is just appended, as in the
<code class="docutils literal notranslate"><span class="pre">list</span></code> structure.  Indexes of their positions are
scattered in the <em>index</em> part of the structure.
The scattering is determined by a <em>hash function</em>.
A hash function (or just <em>hash</em>) of a key is a
function that maps the key deterministically to a
value that is somewhat random (but always the same
for a given key). For example, <code class="docutils literal notranslate"><span class="pre">hash(&quot;dog&quot;)</span></code> might return 28.
There are only 8 slots in the index, so we take
28 mod 8 to compute the index 4.  Slot 4
of the index part contains 0,
indicating that the entry for “dog” is in slot 0
of the <em>items</em> part of the structure.</p>
<p>Suppose we give the command <code class="docutils literal notranslate"><span class="pre">d[&quot;lizard&quot;]</span> <span class="pre">=</span> <span class="pre">18</span></code> to add
(“lizard”, 18) to the hash table.  Maybe <code class="docutils literal notranslate"><span class="pre">hash(&quot;lizard&quot;)</span></code>
returns 36.  36 mod 8 is 4, the same as 28 mod 8, and
slot 4 of the index already contains a reference to the entry
for (“dog”, 22).  This is called a <em>hash collision</em> or
just <em>collision</em>, because the hash indexes for
“dog” and “lizard” have <em>collided</em> at slot 4.
What should we do?</p>
<p>Python uses a
<em>collision resolution</em> approach called <em>open addressing</em>.
You might also summarize it as “if once you don’t succeed,
try, try again”.  Slot 4 is taken, so Python adds something
to the index, again reduces it modulo the number of elements
in the index portion of the structure, and tries again.
Let’s say it adds 5, so it next tries slot (5 + 4) mod 8,
which is 1.  But slot 1 is also in use!  So it adds a larger
number, maybe 197.  (197 + 1) mod 8 is 6, so it tries
slot 6.  That slot is empty, so it stores 2 in that slot to
indicate that slot 2 in the items part is where (“lizard”, 18)
can be found.</p>
<p><img alt="Adding a lizard" src="../_images/dict-3elem.svg" /></p>
<p>If we write <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">d[&quot;lizard&quot;]</span></code>, the same set of <em>probes</em> occurs:
We hash “lizard” and get 36 % 8, and looking in slot 4 of
the indexes we find 0.  We check slot 0 of the items part, but
instead of “lizard” we find “dog”.  Next we add 5, which leads
us to check entry 1, but we find “cat” instead of “lizard”.  Finally
we try slot 6 of the indexes, which leads us to slot 2 of the items,
where we find (“lizard”, 18).  If we instead landed on an empty
slot in the indexes, we would conclude that there was no key “lizard”
and raise a key error.</p>
<p>Note that in our example, the capacity of the hash table is
5 items, but there are 8 slots in the index part of the
structure.  We want to minimize the number of collisions, and we
want the <em>probe sequences</em> (like the sequence 4, 1, 6 for “lizard”)
as short as possible, but without wasting too much space.  At present
Python 3 allocates about 1.5 times as many index slots as
elements.  It uses a quadratic probe sequence that ensures that,
if there is at least one empty index slot, it will always be
found eventually.  The variable size portion of the dict structure
is reallocated whenever the items part is exhausted, so there will
always be available index slots.</p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p>In addition to Python official documentation,
I have relied partially on some of these:</p>
<p>Brayan Rafael Gallardo, summary of class notes from UC Irvine
ICS 33 (based on lectures and notes by Richard Pattis), 2016.
<a class="reference external" href="https://www.ics.uci.edu/~brgallar/index.html">https://www.ics.uci.edu/~brgallar/index.html</a></p>
<p>Artem Golubin, “Python internals: Arbitrary-precision integer
implementation”, 2017.
<a class="reference external" href="https://rushter.com/blog/python-integer-implementation/">https://rushter.com/blog/python-integer-implementation/</a></p>
<p>Python Software Consortium.  <a class="reference external" href="https://github.com/python/cpython">CPython version 3 source code repository</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "UO-CS-OER/CS210-text",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Appendices"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="appendix_style.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Style Guide for Python Programs</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#or-seven-things-they-never-told-you-about-python">Or: Seven things they never told you about Python.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-source-luke">Use the source, Luke</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#translation-and-execution">Translation and Execution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-translation-compared-to-java-c-etc">Python translation compared to Java, C, etc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-data-types-in-cpython">Key Data Types in CPython</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#class-list">Class <code class="docutils literal notranslate"><span class="pre">list</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#class-int">Class <code class="docutils literal notranslate"><span class="pre">int</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#class-dict">Class <code class="docutils literal notranslate"><span class="pre">dict</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michal Young
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2025 University of Oregon.  Creative Commons Share-Alike Attribution license.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>